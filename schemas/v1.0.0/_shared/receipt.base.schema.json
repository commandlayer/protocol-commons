{
  "$id": "https://commandlayer.org/schemas/v1.0.0/_shared/receipt.base.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "receipt.base",
  "description": "Base structure for all CommandLayer receipts, extended on a per-verb basis. Designed for A2A, Swarm-style delegation, and x402 alignment.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "x402": {
      "description": "x402 envelope describing the verb and version for this receipt.",
      "allOf": [
        {
          "$ref": "https://commandlayer.org/schemas/v1.0.0/_shared/x402.schema.json"
        }
      ]
    },
    "trace": {
      "description": "Minimal execution trace for correlating this receipt with the originating request and downstream spans.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "trace_id": {
          "description": "Unique identifier for this execution trace within the provider or agent.",
          "type": "string",
          "minLength": 1,
          "maxLength": 128
        },
        "parent_trace_id": {
          "description": "Optional parent trace identifier for delegated or chained calls.",
          "type": "string",
          "minLength": 1,
          "maxLength": 128
        },
        "started_at": {
          "description": "RFC 3339 timestamp when execution started.",
          "type": "string",
          "format": "date-time",
          "maxLength": 64
        },
        "completed_at": {
          "description": "RFC 3339 timestamp when execution completed.",
          "type": "string",
          "format": "date-time",
          "maxLength": 64
        },
        "duration_ms": {
          "description": "Observed execution duration in milliseconds.",
          "type": "integer",
          "minimum": 0,
          "maximum": 86400000
        },
        "provider": {
          "description": "Logical provider identifier (platform, runtime, or cluster).",
          "type": "string",
          "maxLength": 256
        },
        "region": {
          "description": "Execution region or data residency hint (e.g., us-east-1).",
          "type": "string",
          "maxLength": 64
        },
        "model": {
          "description": "Model or engine identifier, if applicable.",
          "type": "string",
          "maxLength": 256
        },
        "tags": {
          "description": "Optional opaque tags for downstream correlation and observability.",
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 64
          },
          "maxItems": 64
        }
      },
      "required": ["trace_id"]
    },
    "status": {
      "description": "Outcome status for this verb invocation.",
      "type": "string",
      "enum": ["success", "error", "delegated"]
    },
    "error": {
      "description": "Error details when status = 'error'.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "code": {
          "type": "string",
          "minLength": 1,
          "maxLength": 64
        },
        "message": {
          "type": "string",
          "minLength": 1,
          "maxLength": 2048
        },
        "retryable": {
          "description": "Whether the caller may reasonably retry this request.",
          "type": "boolean"
        },
        "details": {
          "description": "Optional provider-specific error details. Non-normative.",
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "delegation_result": {
      "description": "Swarm-style delegation outcome when another agent participated in fulfilling this request.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "performed": {
          "description": "Whether any delegation or handoff actually occurred.",
          "type": "boolean"
        },
        "target_agent": {
          "description": "Identifier (e.g., ENS name) of the downstream agent that took over.",
          "type": "string",
          "maxLength": 256
        },
        "reason": {
          "description": "Human-readable reason for delegation or handoff.",
          "type": "string",
          "maxLength": 1024
        },
        "handoff_trace_id": {
          "description": "Trace or task identifier used by the downstream agent.",
          "type": "string",
          "maxLength": 128
        }
      }
    },
    "metadata": {
      "description": "Optional additional metadata, safe for logging and analytics. Must not change core semantics.",
      "type": "object",
      "additionalProperties": true
    },
    "result": {
      "description": "Verb-specific result payload; concrete shape defined by each verb receipt schema.",
      "type": "object"
    },
    "usage": {
      "description": "Optional resource usage metrics; concrete shape may be extended by each verb receipt schema.",
      "type": "object"
    }
  },
  "required": ["x402", "trace", "status"]
}
